{
  "WELCOME": true,
  "AUTO_REPLY": true,
  "AUTO_VOICE": true,
  "AI_BOT": false,
  "TYPING": false,
  "RECORDING": false,
  "ONLINE": true,
  "FOREX_BOT": false,
  "BINANCE_BOT": false,
  "AUTO_STATUS_SEEN": true,
  "AUTO_STATUS_REPLY": false,
  "ANTI_DELETE": true,
  "ONE_VIEW": false
}
// ./commands/autoUpdate.js  (à¶¸à·šà¶šà·š à¶…à¶œà·„à¶»à·”à·€à·š à¶‘à¶šà¶­à·” à¶šà¶»à¶±à·Šà¶±)
const { generateSignals } = require("./signals")
const cron = require("node-cron")
const axios = require("axios")
const settings = require("../settings.json")

const GROUP_ID = "1203630xxxxx-123456@g.us"

async function getForex() {
  try {
    const { data } = await axios.get("https://api.exchangerate.host/latest?base=USD&symbols=LKR,EUR,GBP")
    const r = data.rates
    return `ðŸ’± *Forex (USD base)*  LKR ${r.LKR} | EUR ${r.EUR} | GBP ${r.GBP}`
  } catch { return "âŒ Forex N/A" }
}

async function getBinanceSummary() {
  try {
    const list = ["BTCUSDT","ETHUSDT","BNBUSDT","XRPUSDT","SOLUSDT"]
    const rows = []
    for (const s of list) {
      const { data } = await axios.get(`https://api.binance.com/api/v3/ticker/price?symbol=${s}`)
      rows.push(`${s.replace("USDT","/USDT")}: $${(+data.price).toFixed(2)}`)
    }
    return rows.join("  |  ")
  } catch { return "âŒ Binance N/A" }
}

module.exports = function autoUpdates(sock) {
  // run every 6h at minute 0
  cron.schedule("0 */6 * * *", async () => {
    try {
      let blocks = []

      if (settings.FOREX_BOT) blocks.push(await getForex())
      if (settings.BINANCE_BOT) blocks.push(`ðŸ“Š *Binance*: ${await getBinanceSummary()}`)

      // Signals section
      if (settings.BINANCE_SIGNALS) {
        const sigs = await generateSignals(4)
        if (sigs.length) {
          blocks.push(`âš¡ *Signals (${sigs.length})*`)
          blocks = blocks.concat(sigs)
        } else {
          blocks.push("âš¡ *Signals*: none this run (daily cap or no setup).")
        }
      }

      const msg = `ðŸ“¢ *PASIYA-MD Market Update*\n\n${blocks.join("\n\n")}\n\n_Powered by PASIYA-MD_`
      await sock.sendMessage(GROUP_ID, { text: msg })
    } catch (e) {
      console.log("AutoUpdate:", e)
    }
  })
}
